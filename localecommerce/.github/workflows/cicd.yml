# name: CI/CD Pipeline for Spring Boot on Azure

# on:
#     push:
#         branches:
#             - main
#             - master
#     pull_request:
#         branches:
#             - main

# jobs:
#     build:
#         runs-on: ubuntu-latest

#         steps:
#             - name: Checkout Code
#               uses: actions/checkout@v4

#             - name: Set up JDK 17
#               uses: actions/setup-java@v3
#               with:
#                   distribution: 'temurin'
#                   java-version: '17'

#             # - name: Cache Maven dependencies
#             #   uses: actions/cache@v3
#             #   with:
#             #     path: ~/.m2
#             #     key: maven-${{ runner.os }}-${{ hashFiles('**/pom.xml') }}
#             #     restore-keys: |
#             #       maven-${{ runner.os }}

#             - name: Build with Maven
#               run: mvn clean install -DskipTests

#             - name: Upload Artifact
#               uses: actions/upload-artifact@v3
#               with:
#                   name: spring-boot-app
#                   path: ${{ github.workspace }}/target/*.jar

#     deploy:
#         runs-on: ubuntu-latest
#         needs: build

#         steps:
#             - name: Checkout Code
#               uses: actions/checkout@v4

#             - name: Download Artifact
#               uses: actions/download-artifact@v3
#               with:
#                   name: spring-boot-app
#                   # path: target/

#             - name: Deploy to Azure Web App
#               uses: azure/webapps-deploy@v2
#               with:
#                   app-name: localshopper
#                   publish-profile: ${{ secrets.AZURE_PUBLISH_PROFILE }}
#                   package: '*.jar'
name: CI/CD Pipeline for Spring Boot on Azure

on:
    push:
        branches:
            - main
            - master
    pull_request:
        branches:
            - main

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout Code
              uses: actions/checkout@v4

            - name: Set up JDK 17
              uses: actions/setup-java@v3
              with:
                  distribution: 'temurin'
                  java-version: '17'

            - name: Cache Maven dependencies
              uses: actions/cache@v3
              with:
                path: ~/.m2
                key: maven-${{ runner.os }}-${{ hashFiles('**/pom.xml') }}
                restore-keys: |
                  maven-${{ runner.os }}

            - name: Build with Maven
              run: mvn clean install -DskipTests

            - name: Upload Artifact
              uses: actions/upload-artifact@v3
              with:
                  name: spring-boot-app
                  path: target/*.jar

    deploy:
        runs-on: ubuntu-latest
        needs: build

        steps:
            - name: Download Artifact
              uses: actions/download-artifact@v3
              with:
                  name: spring-boot-app

            - name: Deploy to Azure Web App
              uses: azure/webapps-deploy@v2
              with:
                  app-name: localshopper
                  publish-profile: ${{ secrets.AZURE_PUBLISH_PROFILE }}
                  package: spring-boot-app/*.jar
